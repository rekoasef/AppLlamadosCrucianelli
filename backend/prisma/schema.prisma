// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CallRecord {
  id                  String     @id @default(cuid())
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  contactName         String
  machineSerialNumber String?
  observations        String?    @db.Text
  status              CallStatus @default(OPEN)

  // --- RELACIÓN CON BUSINESSUNIT ELIMINADA ---

  // El usuario del call center que atendió la llamada
  handledBy   User?   @relation("HandledBy", fields: [handledById], references: [id])
  handledById String?

  // El usuario que creó el registro en el sistema
  createdByUser User   @relation("CreatedBy", fields: [createdById], references: [id])
  createdById   String

  // --- Relaciones con tablas de catálogo ---
  callerType   CallerType @relation(fields: [callerTypeId], references: [id])
  callerTypeId String

  machineType   MachineType? @relation(fields: [machineTypeId], references: [id])
  machineTypeId String?

  billedClient String? 

  dealership   Dealership? @relation(fields: [dealershipId], references: [id])
  dealershipId String?

  inquiryArea   InquiryArea @relation(fields: [inquiryAreaId], references: [id])
  inquiryAreaId String

  responseReason   ResponseReason? @relation(fields: [responseReasonId], references: [id])
  responseReasonId String?

  contactChannel   ContactChannel @relation(fields: [contactChannelId], references: [id])
  contactChannelId String

  durationRange   DurationRange @relation(fields: [durationRangeId], references: [id])
  durationRangeId String

  urgencyLevel   UrgencyLevel @relation(fields: [urgencyLevelId], references: [id])
  urgencyLevelId String
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  password  String
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  handledCalls CallRecord[] @relation("HandledBy")
  createdCalls CallRecord[] @relation("CreatedBy")
}

// --- MODELO BUSINESSUNIT ELIMINADO ---

// ===============================================
// Modelos de Catálogo (para los desplegables)
// ===============================================

model CallerType {
  id      String       @id @default(cuid())
  name    String       @unique
  records CallRecord[]
}

model MachineType {
  id      String       @id @default(cuid())
  name    String       @unique
  records CallRecord[]
}

model Dealership {
  id      String       @id @default(cuid())
  name    String       @unique
  records CallRecord[]
}

model InquiryArea {
  id      String       @id @default(cuid())
  name    String       @unique
  records CallRecord[]
}

model ResponseReason {
  id      String       @id @default(cuid())
  name    String       @unique
  records CallRecord[]
}

model ContactChannel {
  id      String       @id @default(cuid())
  name    String       @unique
  records CallRecord[]
}

model DurationRange {
  id      String       @id @default(cuid())
  name    String       @unique
  records CallRecord[]
}

model UrgencyLevel {
  id      String       @id @default(cuid())
  name    String       @unique
  records CallRecord[]
}

// ===============================================
// Enums (Valores Fijos)
// ===============================================

enum UserRole {
  ADMIN
  USER
}

enum CallStatus {
  OPEN
  IN_PROGRESS
  CLOSED
  PENDING_CLIENT
}